# 可灵AI 对口型服务 API 文档

## 1. 创建对口型任务

### 接口信息

- **请求协议**: HTTPS
- **请求地址**: `/v1/videos/lip-sync`
- **请求方法**: POST
- **请求格式**: application/json
- **响应格式**: application/json

### 请求头

| 字段          | 值                    | 描述                                |
| ------------- | --------------------- | ----------------------------------- |
| Content-Type  | application/json      | 数据交换格式                        |
| Authorization | Bearer {your-api-key} | API 密钥鉴权，格式：`Bearer sk-xxx` |

### 请求参数

#### 主要参数

| 字段         | 类型   | 必填 | 默认值 | 描述                      |
| ------------ | ------ | ---- | ------ | ------------------------- |
| input        | object | 是   | -      | 包含视频和音频/文本等信息 |
| callback_url | string | 否   | -      | 任务状态变更回调地址      |

#### input 对象参数

##### 视频参数（二选一）

| 字段      | 类型   | 必填 | 描述                                                         |
| --------- | ------ | ---- | ------------------------------------------------------------ |
| video_id  | string | 是\* | 可灵AI生成的视频ID，仅支持30天内生成的≤60秒视频              |
| video_url | string | 是\* | 上传视频的URL，支持.mp4/.mov格式，≤100MB，2-60秒，720p/1080p |

\*注：video_id 和 video_url 二选一，不能同时为空或同时有值

##### 模式参数

| 字段 | 类型   | 必填 | 描述                                                               |
| ---- | ------ | ---- | ------------------------------------------------------------------ |
| mode | string | 是   | 生成模式：`text2video`（文本转视频）或 `audio2video`（音频转视频） |

##### 文本转视频模式参数（mode=text2video时必填）

| 字段           | 类型   | 必填 | 默认值 | 描述                             |
| -------------- | ------ | ---- | ------ | -------------------------------- |
| text           | string | 是   | -      | 对口型文本内容，最大120字符      |
| voice_id       | string | 是   | -      | 音色ID，详见音色列表             |
| voice_language | string | 否   | zh     | 音色语种：zh（中文）、en（英文） |
| voice_speed    | float  | 否   | 1.0    | 语速，范围：0.8-2.0              |

##### 音频转视频模式参数（mode=audio2video时必填）

| 字段       | 类型   | 必填 | 描述                                             |
| ---------- | ------ | ---- | ------------------------------------------------ |
| audio_type | string | 是   | 音频传输方式：`file`（上传文件）或 `url`（链接） |
| audio_file | string | 是\* | Base64编码的音频文件（audio_type=file时）        |
| audio_url  | string | 是\* | 音频文件下载URL（audio_type=url时）              |

\*注：支持格式 .mp3/.wav/.m4a/.aac，文件大小≤5MB

### 响应参数

| 字段       | 类型   | 描述                       |
| ---------- | ------ | -------------------------- |
| code       | int    | 错误码，0表示成功          |
| message    | string | 错误信息                   |
| request_id | string | 请求ID，用于跟踪和问题排查 |
| data       | object | 响应数据                   |

#### data 对象参数

| 字段        | 类型   | 描述                                             |
| ----------- | ------ | ------------------------------------------------ |
| task_id     | string | 任务ID，系统生成                                 |
| task_status | string | 任务状态：submitted、processing、succeed、failed |
| created_at  | number | 任务创建时间，Unix时间戳（毫秒）                 |
| updated_at  | number | 任务更新时间，Unix时间戳（毫秒）                 |

### 请求示例

#### cURL 示例

```bash
curl -X POST "https://api.kling.com/v1/videos/lip-sync" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer sk-your-api-key-here" \
  -d '{
    "input": {
      "video_url": "https://example.com/video.mp4",
      "mode": "text2video",
      "text": "你好，这是一个测试文本",
      "voice_id": "zh_female_001",
      "voice_language": "zh",
      "voice_speed": 1.0
    },
    "callback_url": "https://your-domain.com/callback"
  }'
```

#### JSON 请求体示例

**文本转视频模式**：

```json
{
	"input": {
		"video_url": "https://example.com/video.mp4",
		"mode": "text2video",
		"text": "你好，这是一个测试文本",
		"voice_id": "zh_female_001",
		"voice_language": "zh",
		"voice_speed": 1.0
	},
	"callback_url": "https://your-domain.com/callback"
}
```

**音频转视频模式**：

```json
{
	"input": {
		"video_id": "video_abc123",
		"mode": "audio2video",
		"audio_type": "url",
		"audio_url": "https://example.com/audio.mp3"
	}
}
```

### 响应示例

```json
{
	"code": 0,
	"message": "success",
	"request_id": "req_12345678",
	"data": {
		"task_id": "task_abcd1234",
		"task_status": "submitted",
		"created_at": 1722769557708,
		"updated_at": 1722769557708
	}
}
```

---

## 2. 查询单个任务

### 接口信息

- **请求协议**: HTTPS
- **请求地址**: `/v1/videos/lip-sync/{task_id}`
- **请求方法**: GET
- **请求格式**: application/json
- **响应格式**: application/json

### 请求头

| 字段          | 值                    | 描述                                |
| ------------- | --------------------- | ----------------------------------- |
| Content-Type  | application/json      | 数据交换格式                        |
| Authorization | Bearer {your-api-key} | API 密钥鉴权，格式：`Bearer sk-xxx` |

### 路径参数

| 字段    | 类型   | 必填 | 描述         |
| ------- | ------ | ---- | ------------ |
| task_id | string | 是   | 对口型任务ID |

### 请求体

无

### 响应参数

| 字段       | 类型   | 描述                       |
| ---------- | ------ | -------------------------- |
| code       | int    | 错误码，0表示成功          |
| message    | string | 错误信息                   |
| request_id | string | 请求ID，用于跟踪和问题排查 |
| data       | object | 响应数据                   |

#### data 对象参数

| 字段            | 类型   | 描述                                             |
| --------------- | ------ | ------------------------------------------------ |
| task_id         | string | 任务ID                                           |
| task_status     | string | 任务状态：submitted、processing、succeed、failed |
| task_status_msg | string | 任务状态信息，失败时显示失败原因                 |
| task_info       | object | 任务创建时的参数信息                             |
| task_result     | object | 任务结果（仅成功时）                             |
| created_at      | number | 任务创建时间，Unix时间戳（毫秒）                 |
| updated_at      | number | 任务更新时间，Unix时间戳（毫秒）                 |

##### task_info 对象参数

| 字段         | 类型   | 描述       |
| ------------ | ------ | ---------- |
| parent_video | object | 原视频信息 |

###### parent_video 对象参数

| 字段     | 类型   | 描述                    |
| -------- | ------ | ----------------------- |
| id       | string | 原视频ID                |
| url      | string | 原视频URL（30天后清理） |
| duration | string | 原视频时长（秒）        |

##### task_result 对象参数（任务成功时）

| 字段   | 类型  | 描述           |
| ------ | ----- | -------------- |
| videos | array | 生成的视频数组 |

###### videos 数组元素参数

| 字段     | 类型   | 描述                        |
| -------- | ------ | --------------------------- |
| id       | string | 视频ID                      |
| url      | string | 对口型视频URL（30天后清理） |
| duration | string | 视频时长（秒）              |

### 响应示例

```json
{
	"code": 0,
	"message": "success",
	"request_id": "req_12345678",
	"data": {
		"task_id": "task_abcd1234",
		"task_status": "succeed",
		"task_status_msg": "任务成功完成",
		"task_info": {
			"parent_video": {
				"id": "video_123",
				"url": "https://example.com/original_video.mp4",
				"duration": "30"
			}
		},
		"task_result": {
			"videos": [
				{
					"id": "video_456",
					"url": "https://example.com/lip_sync_video.mp4",
					"duration": "30"
				}
			]
		},
		"created_at": 1722769557708,
		"updated_at": 1722769657708
	}
}
```

---

## 3. 查询任务列表

### 接口信息

- **请求协议**: HTTPS
- **请求地址**: `/v1/videos/lip-sync`
- **请求方法**: GET
- **请求格式**: application/json
- **响应格式**: application/json

### 请求头

| 字段          | 值                    | 描述                                |
| ------------- | --------------------- | ----------------------------------- |
| Content-Type  | application/json      | 数据交换格式                        |
| Authorization | Bearer {your-api-key} | API 密钥鉴权，格式：`Bearer sk-xxx` |

### 查询参数

URL示例: `/v1/videos/lip-sync?pageNum=1&pageSize=30`

| 字段     | 类型 | 必填 | 默认值 | 描述                        |
| -------- | ---- | ---- | ------ | --------------------------- |
| pageNum  | int  | 否   | 1      | 页码，取值范围：1-1000      |
| pageSize | int  | 否   | 30     | 每页数据量，取值范围：1-500 |

### 请求体

无

### 响应参数

| 字段       | 类型   | 描述                       |
| ---------- | ------ | -------------------------- |
| code       | int    | 错误码，0表示成功          |
| message    | string | 错误信息                   |
| request_id | string | 请求ID，用于跟踪和问题排查 |
| data       | array  | 任务列表数组               |

#### data 数组元素参数

| 字段            | 类型   | 描述                                             |
| --------------- | ------ | ------------------------------------------------ |
| task_id         | string | 任务ID                                           |
| task_status     | string | 任务状态：submitted、processing、succeed、failed |
| task_status_msg | string | 任务状态信息，失败时显示失败原因                 |
| task_info       | object | 任务创建时的参数信息                             |
| task_result     | object | 任务结果（仅成功时）                             |
| created_at      | number | 任务创建时间，Unix时间戳（毫秒）                 |
| updated_at      | number | 任务更新时间，Unix时间戳（毫秒）                 |

_注：task_info 和 task_result 的结构与单个查询接口相同_

### 响应示例

```json
{
	"code": 0,
	"message": "success",
	"request_id": "req_12345678",
	"data": [
		{
			"task_id": "task_abcd1234",
			"task_status": "succeed",
			"task_status_msg": "任务成功完成",
			"task_info": {
				"parent_video": {
					"id": "video_123",
					"url": "https://example.com/original_video.mp4",
					"duration": "30"
				}
			},
			"task_result": {
				"videos": [
					{
						"url": "https://example.com/lip_sync_video.mp4",
						"duration": "30"
					}
				]
			},
			"created_at": 1722769557708,
			"updated_at": 1722769657708
		}
	]
}
```

---

## 重要说明

### 视频文件限制

- **时长**: 2-60秒
- **分辨率**: 720p 或 1080p，边长 512px-2160px
- **格式**: .mp4/.mov
- **大小**: ≤100MB
- **有效期**: 生成后30天内可用

### 音频文件限制

- **格式**: .mp3/.wav/.m4a/.aac
- **大小**: ≤5MB
- **编码**: Base64编码（file模式）

### 文本限制

- **长度**: 最大120字符
- **语种**: 中文(zh)、英文(en)

### 任务状态说明

- **submitted**: 已提交，等待处理
- **processing**: 处理中
- **succeed**: 成功完成
- **failed**: 处理失败

### 回调协议

当配置了 `callback_url` 时，系统会在任务状态变更时发送POST请求到指定地址，具体消息格式请参考相关文档。
