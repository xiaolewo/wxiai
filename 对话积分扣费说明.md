# 对话积分扣费逻辑说明

## 简单说明

当用户和AI对话时，系统会根据消耗的token数量来扣除积分。简单理解就是：**你说的话越多，AI回复越长，扣的积分就越多。**

## 详细扣费逻辑

### 1. 什么时候扣积分？

每次你发送消息给AI，并且AI回复后，系统就会计算这次对话的成本并扣除积分。

### 2. 怎么计算积分？

积分计算有两种模式：

#### 模式一：按Token计费（主要模式）

- **输入Token（你说的话）**: 你发给AI的文字会被拆解成Token，每1000个Token扣除一定积分
- **输出Token（AI回复）**: AI回复的文字也会被拆解成Token，每1000个Token扣除一定积分
- **图片Token**: 如果你发送图片，系统会根据图片大小计算等价的Token数量

#### 模式二：按次数计费（备选模式）

- 不管你说多少话，AI回复多少，每次对话固定扣除一定积分

### 3. Token是什么？

Token简单理解就是"字符单位"：

- 中文：大约1个汉字 = 2-3个Token
- 英文：大约1个单词 = 1-2个Token
- 例子：你说"今天天气怎么样？"大约是12个Token

### 4. 具体扣费计算

假设一次对话：

- 你说："帮我写一个200字的故事"（约15个Token）
- AI回复：一个200字的故事（约400个Token）

按Token计费：

- 输入费用：15 ÷ 1000 = 0.015，进位到1个单位，扣费 = 单价 × 1
- 输出费用：400 ÷ 1000 = 0.4，进位到1个单位，扣费 = 单价 × 1
- 总扣费 = 输入费用 + 输出费用

### 5. 进位规则

**重要**：系统采用**千进位**规则，即不足1000个Token也按1000个Token计费。

举例：

- 如果你这次对话用了1个Token，按1000个Token收费
- 如果你这次对话用了1500个Token，按2000个Token收费

这样做是为了简化计费，避免复杂的小数计算。

### 6. 其他费用

除了基础的Token费用，可能还有：

- **功能费用**：使用特殊功能（如图片生成）的额外费用
- **自定义费用**：管理员设置的特殊收费项目

### 7. 最终积分显示

所有积分都显示为**整数**，不会出现小数点。比如：

- 扣费3.2积分 → 显示扣费3积分
- 扣费3.8积分 → 显示扣费4积分

## 实际例子

**场景**：你问AI"什么是人工智能？"，AI回复了一段300字的解释。

**计算过程**：

1. 你的问题：约12个Token
2. AI回复：约600个Token
3. 输入费用：12 ÷ 1000 = 0.012，进位到1，扣费1个单位
4. 输出费用：600 ÷ 1000 = 0.6，进位到1，扣费1个单位
5. 假设单价都是1积分，总共扣费：1 + 1 = 2积分

**结果**：你的积分余额减少2积分。

## 如何节约积分？

1. **简洁表达**：说话简洁明了，避免啰嗦
2. **分次询问**：复杂问题分几次问，而不是一次问很长的问题
3. **避免重复**：不要重复问同样的问题
4. **选择合适模型**：不同AI模型价格不同，选择符合需求的经济型模型

## 积分查看

- 在用户设置中可以查看当前积分余额
- 每次对话后可以看到本次对话扣费明细
- 积分记录中可以查看历史消费记录

---

**总结**：积分扣费就是按照你和AI对话的"信息量"来计费，说得越多回复越长费用越高，类似于按流量计费的网络服务。
